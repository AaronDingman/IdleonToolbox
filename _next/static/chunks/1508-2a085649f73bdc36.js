"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1508],{41508:function(l,e,o){o.d(e,{q5:function(){return u},ZX:function(){return getBuildCost},VR:function(){return getConstruction},Bt:function(){return getExtraMaxLevels},d4:function(){return getTowers},ai:function(){return optimizeArrayWithSwaps}});var t=o(1356),n=o(94978);let createCogstructionData=(l,e)=>{let o=null==l?void 0:l.reduce((l,o,t)=>{let n=getCogstructionCogType(e[t]);if(!n)return l;let{a:u="",c:i="",d:a="",b:r="",e:d="",g:v="",k:s="",f:c=""}=o||{},g=[u,i,a,r,d,v,s,c].map((l,e)=>e<7?"".concat(getCogstructionValue(l)||"",","):getCogstructionValue(l)),p=e[t].includes("Player_")?e[t].split("Player_")[1]:"";return"".concat(l,"\n").concat(n,",").concat(p,",").concat(g.join(""))},"cog type,name,build_rate,flaggy_rate,exp_mult,exp_rate,build_rate_boost,flaggy_rate_boost,flaggy_speed,exp_rate_boost"),t="empties_x,empties_y",n=null==e?void 0:e.slice(0,96);for(let l=0;l<8;l++)for(let e=0;e<12;e++){let o=(7-l)*12+e;"Blank"===n[o]&&(t="".concat(t,"\n").concat(e,",").concat(l))}return{cogData:o,empties:t}},getCogstructionCogType=l=>{if("Blank"===l)return null;if(l.includes("Player_"))return"Character";if("CogY"===l)return"Yang_Cog";if("CogZ"===l)return"Omni_Cog";let e=Object.entries({ad:"Plus",di:"X",up:"Up",do:"Down",ri:"Right",le:"Left",ro:"Row",co:"Col",cr:"Omni"}).find(e=>{let[o]=e;return l.endsWith(o)});return e?"".concat(e[1],"_Cog"):"Cog"},getCogstructionValue=l=>{var e;return(null==l?void 0:null===(e=l.name)||void 0===e?void 0:e.includes("%"))?(null==l?void 0:l.value)>0&&!isNaN((null==l?void 0:l.value)/100)?(null==l?void 0:l.value)/100:"":(null==l?void 0:l.value)||""},getConstruction=(l,e)=>{let o=(null==l?void 0:l.CogMap)||(0,t.tryToParse)(null==l?void 0:l.CogM),n=(null==l?void 0:l.CogOrder)||(0,t.tryToParse)(null==l?void 0:l.CogO),u=createCogMap(o,null==n?void 0:n.length),i=parseConstruction(u),a=getFlags(l,i,n,e),r=createCogstructionData(i,n);return{...a,cogstruction:r}},getFlags=(l,e,o,n)=>{let u=(null==l?void 0:l.FlagUnlock)||(0,t.tryToParse)(null==l?void 0:l.FlagU),i=(null==l?void 0:l.FlagsPlaced)||(0,t.tryToParse)(null==l?void 0:l.FlagP);return parseFlags(u,i,e,o,n)},parseConstruction=l=>null==l?void 0:l.map(l=>{var e;return null===(e=Object.entries(l))||void 0===e?void 0:e.reduce((l,e)=>{let[o,t]=e;return(null===n.cogKeyMap||void 0===n.cogKeyMap?void 0:n.cogKeyMap[o])&&(null===n.cogKeyMap||void 0===n.cogKeyMap?void 0:n.cogKeyMap[o])!=="_"?{...l,[o]:{name:null===n.cogKeyMap||void 0===n.cogKeyMap?void 0:n.cogKeyMap[o],value:t}}:{...l,[o]:t}},{})}),createCogMap=(l,e)=>{let o=[];for(let t=0;t<e;t++)o[t]=(null==l?void 0:l[t])||{};return o},parseFlags=(l,e,o,t,u)=>{var i,a;let r=null==l?void 0:l.reduce((l,u,i)=>{let a=null==t?void 0:t[i],r=null==o?void 0:o[i];return[...l,{currentAmount:-11===u?null===n.flagsReqs||void 0===n.flagsReqs?void 0:n.flagsReqs[i]:parseFloat(u),requiredAmount:null===n.flagsReqs||void 0===n.flagsReqs?void 0:n.flagsReqs[i],flagPlaced:null==e?void 0:e.includes(i),cog:{name:a,stats:r,originalIndex:i}}]},[]),d=null!==(a=null==u?void 0:null===(i=u.gemShopPurchases)||void 0===i?void 0:i.find((l,e)=>118===e))&&void 0!==a?a:0,v=null==o?void 0:o.map((l,e)=>({...l,name:null==t?void 0:t[e]})).filter(l=>{let{name:e}=l;return null==e?void 0:e.includes("Player_")}).reduce((l,e)=>{let{a:o}=e;return l+((null==o?void 0:o.value)||0)},0),s=evaluateBoard(r);return{...s,baseBoard:r,totalFlaggyRate:(null==s?void 0:s.totalFlaggyRate)*(1+50*d/100),playersBuildRate:v}},swapElements=(l,e,o)=>{var t,n;let u=[...l],i={...null===(t=u[e])||void 0===t?void 0:t.cog};return u[e]={...u[e],cog:{...null===(n=u[o])||void 0===n?void 0:n.cog}},u[o]={...u[o],cog:i},u},optimizeArrayWithSwaps=function(l,e){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2500,t=[...l],n=evaluateBoard(t),u=null==n?void 0:n[e],i=[],a=Date.now();for(;Date.now()-a<o;){var r,d,v,s,c,g,p,f;let l=Math.floor(Math.random()*t.length),o=Math.floor(Math.random()*t.length);if(l===o||(null==t?void 0:null===(r=t[l])||void 0===r?void 0:r.flagPlaced)||(null==t?void 0:null===(s=t[l])||void 0===s?void 0:null===(v=s.cog)||void 0===v?void 0:null===(d=v.stats)||void 0===d?void 0:d.h)==="everything"||(null==t?void 0:null===(c=t[o])||void 0===c?void 0:c.flagPlaced)||(null==t?void 0:null===(f=t[o])||void 0===f?void 0:null===(p=f.cog)||void 0===p?void 0:null===(g=p.stats)||void 0===g?void 0:g.h)==="everything")continue;let a=swapElements(t,l,o),h=evaluateBoard(a);(null==h?void 0:h[e])>u&&(n=h,t=a,u=null==h?void 0:h[e],i=[...i,{from:l,to:o}])}return{...n,moves:i}},evaluateBoard=l=>{let{boosted:e,relations:o}=getAllBoostedCogs(l),t=0,n=0,u=0,i=null==l?void 0:l.map((l,o)=>{var i,a,r,d,v,s,c,g;let{cog:p}=l||{},{e:f,g:h}=(null==e?void 0:e[o])||{},y=(null==p?void 0:null===(a=p.stats)||void 0===a?void 0:null===(i=a.a)||void 0===i?void 0:i.value)||0,C=(null==p?void 0:null===(d=p.stats)||void 0===d?void 0:null===(r=d.c)||void 0===r?void 0:r.value)||0,M=y*(1+((null==f?void 0:f.value)||0)/100);t+=Math.max(M,0),n+=(null==p?void 0:null===(s=p.stats)||void 0===s?void 0:null===(v=s.d)||void 0===v?void 0:v.value)||0;let m=C+C*((null==h?void 0:h.value)||0)/100;return u+=Math.max(m,0),{...l,cog:{...p,stats:{...null==p?void 0:p.stats,a:{...null==p?void 0:null===(c=p.stats)||void 0===c?void 0:c.a,value:M},c:{...null==p?void 0:null===(g=p.stats)||void 0===g?void 0:g.c,value:m}}}}});return{relations:o,totalBuildRate:t,totalExpRate:n,totalFlaggyRate:u,board:i}},getAllBoostedCogs=l=>{let e={},o=Array(96).fill(0);for(let a=0;a<8;a++)for(let r=0;r<12;r++){var t,n,u,i;let d=(7-a)*12+r,v=null==l?void 0:null===(t=l[d])||void 0===t?void 0:t.cog,s=(null==l?void 0:null===(u=l[d])||void 0===u?void 0:null===(n=u.cog)||void 0===n?void 0:n.stats)||{},c=getAffectedIndexes(v,r,a);if((null==c?void 0:c.length)>0){c=null==c?void 0:null===(i=c.map(l=>{let[e,o]=l;return e<0||o<0||e>=12||o>=8?null:(7-o)*12+e}))||void 0===i?void 0:i.filter(l=>null!==l);let{e:l,f:t,g:n}=s||{};if(l||t||n)for(let l=0;l<c.length;l++){let t=c[l],{e:n,f:u,g:i}=s;if((null==o?void 0:o[t])===0)o[t]={e:{...n,value:Math.ceil(null==n?void 0:n.value)},f:{...u,value:Math.ceil(null==u?void 0:u.value)},g:{...i,value:Math.ceil(null==i?void 0:i.value)}};else{let{e:l,f:e,g:a}=o[t]||{};o[t]={e:{...l,value:Math.ceil(((null==l?void 0:l.value)||0)+((null==n?void 0:n.value)||0))},f:{...e,value:Math.ceil(((null==e?void 0:e.value)||0)+((null==u?void 0:u.value)||0))},g:{...a,value:Math.ceil(((null==a?void 0:a.value)||0)+((null==i?void 0:i.value)||0))}}}e[t]=[...e[t]||[],d]}}}return{boosted:o,relations:e}},getAffectedIndexes=(l,e,o)=>{var t;let n=[];switch(null==l?void 0:null===(t=l.stats)||void 0===t?void 0:t.h){case"diagonal":n.push([e-1,o-1],[e+1,o-1],[e-1,o+1],[e+1,o+1]);break;case"adjacent":n.push([e-1,o],[e,o+1],[e+1,o],[e,o-1]);break;case"up":n.push([e-1,o+2],[e,o+2],[e+1,o+2],[e-1,o+1],[e,o+1],[e+1,o+1]);break;case"right":n.push([e+2,o-1],[e+2,o],[e+2,o+1],[e+1,o-1],[e+1,o],[e+1,o+1]);break;case"down":n.push([e-1,o-2],[e,o-2],[e+1,o-2],[e-1,o-1],[e,o-1],[e+1,o-1]);break;case"left":n.push([e-2,o-1],[e-2,o],[e-2,o+1],[e-1,o-1],[e-1,o],[e-1,o+1]);break;case"row":for(let l=0;l<12;l++)e!==l&&n.push([l,o]);break;case"column":for(let l=0;l<8;l++)o!==l&&n.push([e,l]);break;case"corners":n.push([e-2,o-2],[e+2,o-2],[e-2,o+2],[e+2,o+2]);break;case"around":n.push([e,o-2],[e-1,o-1],[e,o-1],[e+1,o-1],[e-2,o],[e-1,o],[e+1,o],[e+2,o],[e-1,o+1],[e,o+1],[e+1,o+1],[e,o+2]);break;case"everything":for(let l=0;l<8;l++)for(let t=0;t<12;t++)(o!==l||e!==t)&&n.push([t,l])}return n},getTowers=l=>{let e=(null==l?void 0:l.TowerInfo)||(0,t.tryToParse)(null==l?void 0:l.Tower),o=(0,t.tryToParse)(null==l?void 0:l.TotemInfo)||(null==l?void 0:l.TotemInfo);return parseTowers(e,o)},parseTowers=(l,e)=>{var o;let t=null==e?void 0:e[0],u=null==t?void 0:t.reduce((l,e)=>l+e,0),i=Object.keys(n.towers).length,a=l.slice(54,62),r=0,d=0,v=null===(o=Object.entries(n.towers))||void 0===o?void 0:o.map(e=>{let[o,t]=e,n=null==l?void 0:l[null==t?void 0:t.index];return(null==t?void 0:t.index)>=9&&(null==t?void 0:t.index)<=17&&n>50&&(r+=n-50),d+=n,{...t,name:o,level:n,nextLevel:n+1===l[t.index+i],progress:null==l?void 0:l[(null==t?void 0:t.index)+12+2*i],inProgress:null==a?void 0:a.includes(null==t?void 0:t.index),slot:null==a?void 0:a.findIndex(l=>l===(null==t?void 0:t.index))}});return{data:v,buildMultiplier:null===n.randomList||void 0===n.randomList?void 0:n.randomList[13].split(" "),wizardOverLevels:r,totalLevels:d,totalWaves:u,towersTwo:null==l?void 0:l[2]}},getBuildCost=(l,e,o,t)=>{if(0===t)return 20*Math.pow(e+1,2)*Math.pow(1.6,e+1);{var n;let u=Number(null==l?void 0:null===(n=l.buildMultiplier)||void 0===n?void 0:n[t]);return u*Math.pow(o,e)}},u=[250,500,750,1e3,1250,1500,2500],getConstructionMasteryBonus=(l,e)=>6===e?l>=(null==u?void 0:u[6])?30:0:4===e?l>=(null==u?void 0:u[3])?100:0:5===e?l>=(null==u?void 0:u[5])?100:0:3===e&&l>=(null==u?void 0:u[1])?35:0,getExtraMaxLevels=(l,e,o)=>50===e?Math.round(2*o+getConstructionMasteryBonus(l,6,0)):101===e?getConstructionMasteryBonus(l,4,0):100===e?getConstructionMasteryBonus(l,5,0):15===e?getConstructionMasteryBonus(l,3,0):0}}]);